<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gabriela's Run to Z√ºrich</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas {
      display: block;
      margin: 0 auto;
      background: linear-gradient(to top, #aee1f9, #ffffff);
      border: 2px solid #333;
    }
    body {
      text-align: center;
      font-family: Arial, sans-serif;
    }
    h1 {
      margin-top: 1rem;
    }
    .date-selection {
      margin-top: 1rem;
      display: none;
    }
    .date-selection button {
      margin: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background-color: #ff69b4;
      color: white;
      cursor: pointer;
    }
    .calendar-link {
      margin-top: 1rem;
      font-size: 1rem;
      display: none;
    }
    .calendar-link a {
      text-decoration: none;
      color: #007bff;
    }
  </style>
</head>
<body>
  <h1>Gabriela's Run: Basel ‚ûú Z√ºrich üèÉ‚Äç‚ôÄÔ∏è</h1>
  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <div class="date-selection" id="dateOptions">
    <p>You made it to Z√ºrich! üá®üá≠</p>
    <p>Want to go on a taco date with me at my place? üåÆ‚ù§Ô∏è</p>
    <button onclick="pickDate('2025-07-25')">Yes, July 25th</button>
    <button onclick="pickDate('2025-07-27')">Yes, July 27th</button>
  </div>

  <div class="calendar-link" id="calendarLink"></div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const gabrielaImg = new Image();
    gabrielaImg.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f9/Huipil_tradicional_mexicano.svg/512px-Huipil_tradicional_mexicano.svg.png";

    let player = { x: 50, y: 300, width: 40, height: 40, dy: 0, gravity: 1.5, jump: -15, grounded: true };
    let obstacles = [];
    let frames = 0;
    let score = 0;
    let gameOver = false;
    let funnyLabels = ["trust issues", "short kings", "ghosting", "bad texters", "complicated exes"];

    function drawPlayer() {
      ctx.drawImage(gabrielaImg, player.x, player.y, player.width, player.height);
    }

    function createObstacle() {
      const height = Math.random() * 50 + 30;
      const label = funnyLabels[Math.floor(Math.random() * funnyLabels.length)];
      obstacles.push({ x: canvas.width, y: canvas.height - height, width: 50, height, label });
    }

    function drawObstacles() {
      ctx.fillStyle = "#333";
      ctx.font = "12px Arial";
      ctx.textAlign = "center";
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
        ctx.fillStyle = "#000";
        ctx.fillText(ob.label, ob.x + ob.width / 2, ob.y - 5);
        ctx.fillStyle = "#333";
      });
    }

    function detectCollision(rect1, rect2) {
      return (
        rect1.x < rect2.x + rect2.width &&
        rect1.x + rect1.width > rect2.x &&
        rect1.y < rect2.y + rect2.height &&
        rect1.y + rect1.height > rect2.y
      );
    }

    function update() {
      if (gameOver) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Background distance line
      ctx.fillStyle = "#555";
      ctx.fillRect(0, 350, canvas.width, 3);

      // Update player
      player.y += player.dy;
      player.dy += player.gravity;

      if (player.y > 300) {
        player.y = 300;
        player.dy = 0;
        player.grounded = true;
      }

      drawPlayer();

      // Update obstacles
      obstacles.forEach(ob => ob.x -= 5);
      obstacles = obstacles.filter(ob => ob.x + ob.width > 0);

      if (frames % 80 === 0) createObstacle();
      drawObstacles();

      // Collision detection
      obstacles.forEach(ob => {
        if (detectCollision(player, ob)) {
          gameOver = true;
        }
      });

      // Score
      score++;
      ctx.fillStyle = "#000";
      ctx.font = "20px Arial";
      ctx.fillText(`Distance: ${score} m`, 10, 30);

      if (score >= 100) {
        gameOver = true;
        document.getElementById("dateOptions").style.display = "block";
      }

      if (gameOver && score < 1500) {
        ctx.fillStyle = "#dc3545";
        ctx.font = "28px Arial";
        ctx.fillText("Oops! Try again.", 290, 200);
      }

      frames++;
      if (!gameOver) requestAnimationFrame(update);
    }

    document.addEventListener("keydown", e => {
      if ((e.code === "Space" || e.code === "ArrowUp") && player.grounded) {
        player.dy = player.jump;
        player.grounded = false;
      }
      if (gameOver && e.code === "Enter") {
        location.reload();
      }
    });

    function pickDate(dateStr) {
      const calURL = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=Taco+Date+with+Reon&dates=${dateStr.replace(/-/g, '')}T180000Z/${dateStr.replace(/-/g, '')}T200000Z&details=Reon+will+pick+you+up+at+your+place+%F0%9F%9A%97&location=Z%C3%BCrich`;
      const linkDiv = document.getElementById("calendarLink");
      linkDiv.innerHTML = `<p>See you on ${dateStr} üíñ</p><a href="${calURL}" target="_blank">Add to Calendar üìÖ</a>`;
      linkDiv.style.display = "block";
    }

    update();
  </script>
</body>
</html>
